# API Routes

This document provides a high-level overview of all API routes available in the application, categorized by their domain. For detailed request/response schemas, status codes, and specific handler information, please refer to the individual markdown files within the `docs/2.0-architecture/2.4-api/` directory.

## AI Routes

### POST /api/ai/ai-page/messages/[pageId]
**Purpose:** Handles AI chat interactions for a specific AI Page.

### PATCH /api/ai/ai-page/settings/[pageId]
**Purpose:** Updates AI chat settings (model, temperature, system prompt) for a specific AI Page.

### GET /api/ai/ai-assistant/conversations
**Purpose:** Fetches a list of AI assistant conversations for a specific user and drive.

### GET /api/ai/ai-assistant/conversations/[conversationId]
**Purpose:** Fetches all active messages within a specific AI assistant conversation.

### POST /api/ai/ai-assistant/messages
**Purpose:** Handles AI assistant chat, including conversation management, message editing/regeneration, and page context.

### POST /api/ai/ai-assistant/promote
**Purpose:** Promotes an AI assistant conversation to a permanent page (AI_CHAT type) within a drive.

### POST /api/ai/dashboard-assistant/messages
**Purpose:** Handles AI assistant chat for the user's personal dashboard.

### PATCH /api/ai/settings/[chatId]
**Purpose:** Updates AI chat settings (model, temperature, system prompt) for a specific AI chat.

### PATCH /api/ai/user-settings
**Purpose:** Creates or updates a user's AI provider setting.

### DELETE /api/ai/user-settings
**Purpose:** Deletes a user's API key for a specific provider.

## Auth Routes

### GET /api/auth/csrf
**Purpose:** Generates a CSRF token for the current authenticated session. Used for CSRF protection in forms and state-changing requests.

### POST /api/auth/login
**Purpose:** Authenticates a user with email/password. Includes rate limiting, session management, and issues secure access/refresh tokens as HttpOnly cookies.

### POST /api/auth/logout
**Purpose:** Logs out a user by invalidating their refresh token in the database and clearing authentication cookies.

### GET /api/auth/me
**Purpose:** Retrieves the currently authenticated user's details from their JWT access token.

### POST /api/auth/refresh
**Purpose:** Refreshes access and refresh tokens using a one-time refresh token. Implements token rotation for enhanced security.

### POST /api/auth/signup
**Purpose:** Registers a new user with email/password validation, creates their personal drive, and establishes their initial session.

## Channel Routes

### GET /api/channels/[pageId]/messages
**Purpose:** Fetches all messages for a specific channel page.

### POST /api/channels/[pageId]/messages
**Purpose:** Sends a new message to a specific channel page.

## Drive & Group Routes

### GET /api/drives
**Purpose:** Fetches all drives accessible by the authenticated user (owned and shared).

### POST /api/drives
**Purpose:** Creates a new drive for the authenticated user.

### GET /api/drives/[driveSlug]/groups
**Purpose:** Fetches all groups associated with a specific drive by slug.

### POST /api/drives/[driveSlug]/groups
**Purpose:** Creates a new group within a specific drive by slug.

### PATCH /api/drives/[driveSlug]/groups/[groupId]
**Purpose:** Updates an existing group's name within a specific drive by slug.

### DELETE /api/drives/[driveSlug]/groups/[groupId]
**Purpose:** Deletes a group from a specific drive by slug.

### GET /api/drives/[driveSlug]/pages
**Purpose:** Fetches all pages (or permitted pages) within a specific drive, structured as a tree.

### GET /api/drives/[driveSlug]/trash
**Purpose:** Fetches all trashed pages within a specific drive.

### POST /api/groups/[groupId]/members
**Purpose:** Adds a user as a member to a specific group.

### DELETE /api/groups/[groupId]/members/[userId]
**Purpose:** Removes a user from a specific group.

## Page & Mention Routes

### GET /api/mentions/search
**Purpose:** Searches for pages, users, and AI conversations to be used in mentions.

### POST /api/pages
**Purpose:** Creates a new page.

### GET /api/pages/[pageId]
**Purpose:** Fetches details for a specific page.

### PATCH /api/pages/[pageId]
**Purpose:** Updates a page's title or content, and processes HTML mentions to sync the mentions table.

### DELETE /api/pages/[pageId]
**Purpose:** Moves a page (and optionally its children) to trash.

### GET /api/pages/[pageId]/breadcrumbs
**Purpose:** Fetches the breadcrumbs (ancestor path) for a given page.

### GET /api/pages/[pageId]/children
**Purpose:** Fetches the direct children pages of a given page.

### GET /api/pages/[pageId]/permissions
**Purpose:** Fetches all permissions for a specific page, including owner and enriched subject details.

### POST /api/pages/[pageId]/permissions
**Purpose:** Creates a new permission for a page.

### DELETE /api/pages/[pageId]/permissions/[permissionId]
**Purpose:** Revokes a specific permission from a page.

### POST /api/pages/[pageId]/restore
**Purpose:** Restores a trashed page (and its trashed children) from the trash.

### PATCH /api/pages/reorder
**Purpose:** Reorders a page by changing its parent and/or position.

### GET /api/pages/search
**Purpose:** Searches for pages by title within a specific drive.

## Trash Routes

### DELETE /api/trash/[pageId]
**Purpose:** Permanently deletes a trashed page and its children from the database.

## User Routes

### GET /api/users/find
**Purpose:** Finds a user by email.

### GET /api/user/dashboard
**Purpose:** Retrieves the user's personal dashboard layout.

### PATCH /api/user/dashboard
**Purpose:** Updates the user's personal dashboard layout.